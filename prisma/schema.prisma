// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id         Int          @id @default(autoincrement())
  email      String       @unique
  password   String
  name       String
  role       String       @default("USER")
  points     Int          @default(0)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  packs      Pack[]       
  playerCards PlayerCard[]
  roomPlayers RoomPlayer[]
  mazos      Mazo[]      // Relaci√≥n con los mazos del usuario
  matchResults MatchResult[]
}

model Player {
  id          Int           @id @default(autoincrement())
  name        String
  team        String
  position    String
  nationality String
  club        String
  rarity      String
  rating      Int
  overall     Int
  vision      Int
  dribble     Int
  pass        Int
  attack      Int
  defense     Int
  speed       Int
  image       String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  playerCards PlayerCard[]
}

model PlayerCard {
  id        Int      @id @default(autoincrement())
  playerId  Int
  userId    Int
  rarity    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  player    Player   @relation(fields: [playerId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
  isLocked  Boolean  @default(false)
  roomPlayers RoomPlayer[]

  @@index([playerId])
  @@index([userId])
}

model Pack {
  id        Int       @id @default(autoincrement())
  type      String
  opened    Boolean   @default(false)
  userId    Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  user      User      @relation(fields: [userId], references: [id])

  @@index([userId])
}

model Mazo {
  id        Int      @id @default(autoincrement())
  nombre    String
  usuarioId Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  usuario   User     @relation(fields: [usuarioId], references: [id])

  @@index([usuarioId])
}

model Room {
  id       Int       @id @default(autoincrement())
  code      String    @unique
  hostId   String
  private  Boolean   @default(true)
  status   String    @default("waiting")
  maxPlayers Int     @default(10)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  roomPlayers RoomPlayer[]
}

model RoomPlayer {
  id        Int      @id @default(autoincrement())
  roomId    Int
  userId    Int
  team      Int // 0 o 1
  pickCardId Int? // carta seleccionada
  ready     Boolean  @default(false)
  joinedAt  DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
  room     Room     @relation(fields: [roomId], references: [id])
  pick     PlayerCard? @relation(fields: [pickCardId], references: [id])

  @@index([pickCardId])
}

model Match {
  id        Int       @id @default(autoincrement())
  roomId    String
  startedAt DateTime  @default(now())
  finishedAt DateTime?
  result   String?
  matchResults MatchResult[]
}

model MatchResult {
  id        Int      @id @default(autoincrement())
  matchId   Int
  userId    Int
  pointsWon Int      
  goals     Int      @default(0)
  assists   Int      @default(0)
  saves     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  match     Match    @relation(fields: [matchId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@index([matchId])
  @@index([userId])
}